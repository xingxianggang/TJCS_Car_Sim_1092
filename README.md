# 车辆交通流模拟系统用户说明书

## 系统概述

本系统基于 EasyX 图形库，采用 C++ 构建了一套高仿真的桥梁交通流动态模拟平台，深度融合环境感知与智能决策机制。系统不仅能够实时模拟多种天气条件与昼夜光照变化对交通流的影响，还集成了高精度的车辆类型识别、自适应智能变道策略以及多维度交通统计分析等核心功能。用户可通过交互式界面动态调节关键参数，灵活切换车辆生成模式、环境场景与运行策略，实现对复杂交通行为的可视化探索与量化评估。该平台兼具科研价值与工程实用性，为智能交通系统的研究与教学提供了一个高效、直观且高度可扩展的仿真环境。

## 界面布局

系统界面分为三个主要区域：
**1.顶部控制栏**：包含桥参数信息、天气控制、时间控制、参数调节等
**2右侧控制栏**：清除对应模拟车道中事故车辆
**3.模拟车道区域**：车辆行驶的主要区域，包含6条车道

## 顶部控制栏功能

### 桥梁参数信息

- **显示位置**：左上角
- **显示内容**：桥长、桥宽、桥宽放大率
- **格式**：`桥长： 100m  桥宽：50m  桥宽放大率： 1.0`

### 天气控制按钮

- **显示位置**：顶部横条中间
- **按钮功能**：
  - **正常按钮**：`[正常]` - 切换到正常天气
  - **下雨按钮**：`[下雨]` - 切换到下雨天气
  - **下雪按钮**：`[下雪]` - 切换到下雪天气
- **作用效果**：天气变化会自动调整安全距离和停止速度

### 时间控制按钮

- **位置**：天气按钮右侧
- **按钮功能**：
  - **白天按钮**：`[白天]` - 切换到白天模式
  - **黑夜按钮**：`[黑夜]` - 切换到黑夜模式
- **作用效果**：时间变化会影响环境照度和安全距离

### 参数调节按钮

- **位置**：顶部横条左侧
- **车辆生成频率控制**：
  - `频+`：增加生成频率（数值越小生成越频繁）
  - `频-`：减少生成频率
- **安全距离控制**：
  - `距+`：增加安全距离（默认700像素）
  - `距-`：减少安全距离
- **停止速度控制**：
  - `速+`：增加停止速度（减速度值）
  - `速-`：减少停止速度

### 实时状态显示

- **位置**：参数按钮右侧
- **显示内容**：生成频率、探测距离、减速度、照度
- **格式**：`生成频率:10 探测距离:700 减速度:15 照度: 100000.00 lux`

### 退出按钮

- **位置**：右上角
- **功能**：点击退出程序

## 车道功能

### 车道布局

- **总车道数**：6条
- **上行车道**：车道0、1、2（车辆从左向右行驶）
- **下行车道**：车道3、4、5（车辆从右向左行驶）
- **方向指示**：左侧显示箭头（→上行，←下行）

### 车道清除按钮

- **位置**：右侧控制栏，对应左侧一个车道内的车辆
- **外观**：灰色圆角矩形，内部有红色X标记，象征追尾的车辆
- **功能**：点击清除对应车道上的所有车辆

## 车辆类型

### 小轿车（Sedan）

- **外观**：流线型车身，三厢结构
- **安全距离**：标准安全距离的80%
- **变道速度**：相对较快

### 运动型多用途汽车 (SUV)

- **外观**：方正车身，车顶平直，有橙色装饰条
- **安全距离**：标准安全距离
- **变道速度**：中等

### 大卡车（Truck）

- **外观**：驾驶舱+货厢结构
- **安全距离**：标准安全距离的150%
- **变道速度**：相对较慢

## 状态标识

### 正常状态

- **颜色**：随机颜色车身
- **显示**：车速数字在车辆上方

### 接近危险

- **标识**：车辆周围显示橘色边框
- **条件**：与前车距离小于安全距离但大于碰撞距离

### 尝试变道

- **标识**：车辆周围显示蓝色边框
- **条件**：准备变道或正在变道

### 抛锚状态

- **外观**：灰色车身，红色X标记
- **条件**：发生碰撞或故障

### 轨迹预测

- **蓝色轨迹**：安全的行驶轨迹
- **灰色轨迹**：普通行驶轨迹
- **显示位置**：预测未来30步的车辆位置

## 参数说明

### 车辆生成频率

- **取值范围**：1-100
- **默认取值**：10
- **数值含义**：数值越小，车辆生成越频繁

### 安全距离

- **取值范围**：100-2000像素
- **默认取值**：700像素
- **影响因素**：天气、时间
- **数值含义**：车辆间保持的最小距离

### 停止速度

- **取值范围**：1-50像素/帧
- **默认取值**：15像素/帧
- **影响因素**：受天气影响（雨天降低20%，雪天降低40%）
- **数值意义**：车辆减速的减速度数值

### 环境照度

**取值范围**：根据天气情况取对应值，单位为勒克斯
**实时显示**：实时显示当前环境照度
**行驶影响**：照度越低，安全距离越短

## CSV文件输出

### 文件位置

- **目录**：程序运行目录下的  log  文件夹
- **需要**：确保该目录存在，以正常生成文件

### 输出文件

#### 1. vehicle_probability_statistics.csv

- **内容**：各类型车辆的出现概率统计
- **列**：VehicleType（车辆类型）, Count（数量）, Probability（概率）
- **示例**：
  ```
  VehicleType,Count,Probability
  Sedan,45,0.35
  SUV,52,0.41
  Truck,31,0.24
  ```

#### 2. breakdown_rate_statistics.csv

- **内容**：不同参数设置下的故障率统计
- **列**：Time(s)（时间）, SafeDistance（安全距离）, Deceleration（减速度）, BreakdownCount（抛锚数量）, VehicleCount（总车辆数）, BreakdownRate（故障率）
- **示例**：
  ```
  Time(s),SafeDistance,Deceleration,BreakdownCount,VehicleCount,BreakdownRate
  10.0,700,15,2,45,0.0444
  25.5,500,12,5,38,0.1316
  ```

## 操作说明

### 基本操作

1. **开始运行**：直接运行程序
2. **参数调节**：点击顶部控制栏的相应按钮
3. **清除车辆**：点击右侧控制栏的清除按钮
4. **切换模式**：点击天气和时间按钮
5. **退出程序**：点击右上角退出按钮

### 高级功能

1. **观察统计**：运行一段时间后查看CSV文件
2. **场景测试**：调整参数观察交通流变化
3. **天气测试**：切换不同天气观察安全距离变化
4. **故障率分析**：观察不同参数下的抛锚情况

## 注意事项

1. **文件路径**：确保程序目录下有 `log` 文件夹用于CSV输出
2. **参数范围**：注意参数调节的合理范围
3. **性能考虑**：车辆过多时可能影响运行流畅度
4. **内存管理**：程序退出时会自动释放所有车辆内存

## 故障排除

- **CSV文件未生成**：检查 `log` 文件夹是否存在
- **车辆显示异常**：检查参数设置是否合理
- **程序运行缓慢**：减少车辆生成频率或关闭天气效果
- **按钮无响应**：确保鼠标点击位置正确

